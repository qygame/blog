#+title: redis
#+date: 2025-10-02 18:07:50
#+hugo_section: docs
#+hugo_bundle: server/redis
#+export_file_name: index
#+hugo_weight: 9
#+hugo_draft: false
#+hugo_auto_set_lastmod: t
#+hugo_custom_front_matter: :bookCollapseSection false
#+hugo_paired_shortcodes: qr %columns %details %hint mermaid %steps tabs tab

redis

#+hugo: more


* redis
** 已使用字段
   | 含义           | key                      | val                 | val_type_in_redis | 场景                                            | 备注       |
   |----------------+--------------------------+---------------------+-------------------+-------------------------------------------------+------------|
   | 玩家信息       | player_$uid              | tagUserInfo         | string            | 数据库与svr缓存                                 | 暂时未使用 |
   |----------------+--------------------------+---------------------+-------------------+-------------------------------------------------+------------|
   | 排行榜         | rank_$rankid             | zset<uid,score>     | ordered_set       | rank data                                       |            |
   |----------------+--------------------------+---------------------+-------------------+-------------------------------------------------+------------|
   | 排行榜过期时间 | rank_$rankid_expire      | int64_t             | string            |                                                 | 毫秒       |
   |----------------+--------------------------+---------------------+-------------------+-------------------------------------------------+------------|
   | 玩家任务状态   | task_status_$uid_$taskid | tagTaskstatus       | string            | task data                                       |            |
   |----------------+--------------------------+---------------------+-------------------+-------------------------------------------------+------------|
   | uggr索引       | gate_$uid                | gatesvr_id          | string            | uid在哪个gateSvr                                | 不含机器人 |
   |                |                          |                     |                   | 玩家在多个gateSvr重复登陆时候, 校验             | 暂时未使用 |
   |----------------+--------------------------+---------------------+-------------------+-------------------------------------------------+------------|
   | uggr索引       | room_$uid                | roomsvr_id          | string            | uid在哪个roomSvr                                | 不含机器人 |
   |                |                          |                     |                   | 只在uid登陆gate时候, gate用来记录map<uid, room> |            |
   |                |                          |                     |                   | 后续map<uid, room> 通过roomSvr主动通知gate      |            |
   |----------------+--------------------------+---------------------+-------------------+-------------------------------------------------+------------|
   | 可用桌子号     | table                    | set<tableid>        | unordered_set     |                                                 |            |
   |----------------+--------------------------+---------------------+-------------------+-------------------------------------------------+------------|
   | 已用桌子号     | table_using              | zset<tableid, time> | unordered_set     |                                                 |            |
   |----------------+--------------------------+---------------------+-------------------+-------------------------------------------------+------------|
   | 已用桌子号     | table_using_$tableid     | $severid_$kindid    | string            | gateSvr用来查询tableid在哪个server上面          |            |
   |----------------+--------------------------+---------------------+-------------------+-------------------------------------------------+------------|
** 已使用lock字段
   | 含义         | key              | 备注                 |
   |--------------+------------------+----------------------|
   | 玩家信息锁   | lock_player_$uid |                      |
   |--------------+------------------+----------------------|

* TODO server--redis
  redis 控制服务
  1. 初始化redis
  2. redis中机器人对回收等
