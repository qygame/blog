<!doctype html><html lang=en dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://qygame.github.io/blog/posts/"><meta property="og:site_name" content="QYGame"><meta property="og:title" content="Posts"><meta property="og:locale" content="en"><meta property="og:type" content="website"><title>Posts | QYGame</title>
<link rel=manifest href=/blog/manifest.json><link rel=icon href=/blog/favicon.png><link rel=canonical href=https://qygame.github.io/blog/posts/><link rel=stylesheet href=/blog/book.min.309b7ed028807cdb68d8d61e26d609f48369c098dbf5e4d8c0dcf4cdf49feafc.css integrity="sha256-MJt+0CiAfNto2NYeJtYJ9INpwJjb9eTYwNz0zfSf6vw=" crossorigin=anonymous><script defer src=/blog/fuse.min.js></script><script defer src=/blog/en.search.min.9645c747058cdcbb805edc17c26f93fa523f7d609ee769d94e1de9286dc6cc6b.js integrity="sha256-lkXHRwWM3LuAXtwXwm+T+lI/fWCe52nZTh3pKG3GzGs=" crossorigin=anonymous></script><link rel=alternate type=application/rss+xml href=https://qygame.github.io/blog/posts/index.xml title=QYGame></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/blog/><span>QYGame</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><input type=checkbox id=section-d09102f6d18a91f5dc9f0da2dfb6a537 class=toggle>
<label for=section-d09102f6d18a91f5dc9f0da2dfb6a537 class="flex justify-between"><a role=button>client</a></label><ul><li><input type=checkbox id=section-39baa70203a8a50cdb904b07d583bf34 class=toggle>
<label for=section-39baa70203a8a50cdb904b07d583bf34 class="flex justify-between"><a role=button>unity, android, ios基础</a></label><ul><li><a href=/blog/docs/client/base/unity/>unity</a></li><li><a href=/blog/docs/client/base/android/>Android</a></li></ul></li><li><a href=/blog/docs/client/env_init/>环境搭建</a></li><li><input type=checkbox id=section-9359d3f28129ad095652cf9ef22808a3 class=toggle>
<label for=section-9359d3f28129ad095652cf9ef22808a3 class="flex justify-between"><a role=button>打包流程</a></label><ul><li><a href=/blog/docs/client/build/build/>unity打包注意事项</a></li><li><a href=/blog/docs/client/build/build_apple/>苹果打包流程</a></li></ul></li><li><input type=checkbox id=section-3220090dd26cfc128f101bf2c1583e6c class=toggle>
<label for=section-3220090dd26cfc128f101bf2c1583e6c class="flex justify-between"><a role=button>sdk介绍</a></label><ul><li><a href=/blog/docs/client/sdk/bdframework/>BDFramework</a></li><li><a href=/blog/docs/client/sdk/sharesdk/>ShareSDK</a></li></ul></li><li><a href=/blog/docs/client/subgame/>子游戏</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/blog/svg/menu.svg class=book-icon alt=Menu>
</label><strong>Posts</strong>
<label for=toc-control><img src=/blog/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav><ul><li class=book-section-flat><strong>Categories</strong><ul></ul></li><li class=book-section-flat><strong>Tags</strong><ul></ul></li></ul></nav></aside></header><article class="markdown book-post"><h2><a href=/blog/posts/client/>Client</a></h2><p>client # 脚本目录架构 # Scripts &ndash; /Define 公共定义 &ndash; &ndash; GameRunTimeData.cs 保存了运行时候需要的数据, 比如UserInfo就是其的成员变量 &ndash; &ndash; GlobalConst.cs 保存了游戏中的常量 &ndash; /Model 模块 &ndash; /Net 网络 &ndash; &ndash; /NetLogic 网络具体事务处理 &ndash; &ndash; /NetSocket 网络底层服务 &ndash; /UI &ndash; &ndash; /Surfaces &ndash; &ndash; /Login &ndash; &ndash; &ndash; LoginTransfer.cs ui界面的总控制类， 其底下一般是各种btn的点击函数 &ndash; &ndash; &ndash; BtnClick_Logon_Account.cs 账号登录按钮的 响应函数 &ndash; /Utility 实用脚本， 可以理解为与系统相关的脚本 &ndash; GameApp.cs Compontes目录下所有类的 管理类 断线重连 # 表1: socket断开, socket重新连接后, 需要完成的事情: socket 服务器 需求 备注 游戏服 1.
<a href=/blog/posts/client/>...</a></p></article><article class="markdown book-post"><h2><a href=/blog/posts/readme/>Readme</a></h2><p>简介 # 休闲游戏模板, 包含服务器, 客户端, 数据库和监控系统. 服务器运行在docker容器,支持docker-compose与k8s两种安装方式. 使用C++开发. 客户端使用unity平台, 使用C#开发. 数据库使用redis, mysql. 监控系统采用prometheus + grafana. 安装 # 下载开发环境. 包含了数据库, 游戏运行环境, redis等 git clone git@github.com:qydocker/docker-compose.git && cd docker-compose ./build.sh dev *下载监控 (可选) git clone git@github.com:qydocker/docker-compose.git && cd docker-compose ./build monitor 下载执行文件 git clone --branch 1.0.0 git@github.com:qygame/svr-publish.git && cd svr-publish ./server.sh start 游戏功能 # 登陆模块 - 重复登陆，断线重连. 登陆方式支持: 账号密码，游客，微信等 房间列表显示模块 房卡场 创建界面 金币场 列表展示 房间创建流程 子游戏模块 房间结束后， 信息统计 大局战绩 小局战绩 录像回放 财富修改记录 任务模块 排行榜 比赛场 活动模块 工会 源码仓库 # 详细介绍 源码设计文档 # 服务器架构介绍 服务器源码介绍 客户端介绍</p></article><article class="markdown book-post"><h2><a href=/blog/posts/repository/>Repository</a></h2><p>构建流程 # qydocker与qygame协同工作, 构建docker images. 具体流程如下图: qydocker # 管理docker image. 负责image构建与运行. 托管在qydocker organization 仓库名 作用 qydocker/build_image_dev 构建qygame base image qydocker/build_publish 编译qygame, 结果托管在qygame/svr-publish qydocker/build_image 构建qygame images qydocker/docker-compose 使用docker-compose管理qygame images qydocker/k8s 使用k8s管理qygame images qydocker/mirror_google_image google docker镜像映射到dockerhub, 加快访问速度 qygame # 管理游戏源码, 主要有server端代码, client代码, protocol协议, database. 托管在qygame organization 仓库名 作用 备注 qygame/svr-kernel 业务与基础库的适配层 qygame/svr-frame 业务层 依赖svr-kernel qygame/svr-subgames 子游戏 依赖svr-frame qygame/protocol client与server消息协议 qygame/client client qygame/database 数据库 qygame/svr-publish 以branch形式存放svr编译结果</p></article><article class="markdown book-post"><h2><a href=/blog/posts/server/>Server</a></h2><p>约定俗称 # 消息号命名规范 # 为了client与server的统一, 消息号统一使用驼峰式命名, exp: SubQueryGoldRooms 第一个字段 归属标志 可能的赋值 Sub C端向S端查询 Cmd S端返回给C端 L2G logon->Game G2L game->logon 只有Lgon, game间的消息号使用 LG字样, 其他全部是Sub, Cmd 第二个字段 意图 增删改查 第三个字段 对象 被op对象 &ndash; 可以没有 第四个字段 消息号含义 结构体的命名为 消息号前面增加Str 函数的命名为 消息号前面增加On 玩家的桌子号 # player.tableid 含义: 玩家在哪个桌子上 用途: 登录的时候 判断断线重连 进入table时的校验, 防止加入2张桌子 状态变化: roomSvr table加入|坐下, 设置为桌子的tableid roomSvr table离开, 如果是比赛场,设置为MATCH_TABLE, 否则INVALID_TABLE matchSvr 报名成功, 设置为MATCH_TABLE matchSvr 取消报名, 设置为INVALID_TABLE 房间流程 # 创建房间 &ndash; 门票检测, 房间规则显示 RoomServer处理 房间规则使用rule_arry结构体传送给客户端显示 加入房间 &ndash; 门票检测 GameServer处理 门票检测时 也会进行游戏资格检测 房间规则在子游戏的显示 RoomServer frame处理 frame调用子游戏SubRuleDes()接口, 显示子游戏规则描述信息 玩家信息在子游戏的显示 RoomServer frame处理 玩家站起|坐下|准备|离开等动作, 会携带玩家信息, 发送给client client根据动作, 判断是绘制还是删除玩家 玩家财富变更后, LogonServer会通知client, 更改大厅的显示 如果在子游戏中, RoomServer frame会通知client, 更改子游戏的显示 即SubGame子游戏不再提供玩家分数相关信息给client 游戏开始|一小局后 &ndash; 门票扣除 RoomServer frame处理 门票扣除信息 在RoomRuleCom中, 由GameServer生成 每小局游戏结束 &ndash; 游戏小局结算 RoomServer frame处理 小局结算写分 战绩记录 录像回放 每局游戏结束后 &ndash; 游戏资格检测 RoomServer frame处理 数据在RoomRuleCom中, 由GameServer提供, 由CenterServer实际处理 server-gate # logon # 重复登陆 # 在当前gateSvr中重复登陆 auto player = player_manager.
<a href=/blog/posts/server/>...</a></p></article><article class="markdown book-post"><h2><a href=/blog/posts/server_view/>Server View</a></h2><p>服务器架构 # logic view # @startuml client -> gate : test @enduml implementation view # process view # deployment view # TODO 后期补充k8s部署下的 deployment view use case view # 服务器说明 # 服务器 说明 有状态 状态量 业务多线程 业务多线程原因 备注 center 路由 n n db 数据库代理 n y database操作耗时 gate 网关 y map[gid, uid] n 无业务逻辑 logon 登录 n n lobby 大厅 n n game 查询, 创建, 加入 房间 n n 加载了房卡场与金币场的配置文件 match 比赛场服务器 y match自身数据stage_index等 n match_manager有map&lt;int,match> room 游戏房间的具体处理 y 房间数据 n rank 排行榜 y rank_manager有map&lt;int,rank> n redis 维护redis数据 n n task 任务 y task_manager有map&lt;int,task> n chat 聊天服务器 n n ready to write club 俱乐部服务器 n n ready to write client 模拟client测试 y ugmanager有map&lt;gid,uid> n 什么时候使用业务多线程 当业务逻辑的处理时间耗时较久的时候, 使用业务多线程 业务多线程优点 是加快了速度 业务多线程缺点 编码复杂(增加了出错概率)</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav><ul><li class=book-section-flat><strong>Categories</strong><ul></ul></li><li class=book-section-flat><strong>Tags</strong><ul></ul></li></ul></nav></div></aside></main></body></html>